<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta id="i18n_pagename" content="index-common">
	<link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/progress.css" />
	<link type="image/x-icon" href="img/favicon.png" rel="shortcut icon"/>	
	<style>
	.on {display:on}
	.off {display:none}
	span{
		font-size: 14px;
	}
	#countDownPage{
		position: relative;
		margin: 0 auto;
		width: 50%;
		top: 150px;
		height: 300px;
	}
	
	</style>
	<script language=JavaScript>
		var count = <% getInfo("countDownTime"); %>*1;
		var pocketRouter_Mode="<% getInfo("pocketRouter_Mode_countdown"); %>"*1; /* 1:client 2:AP */
		var waitcount = <% getInfo("countDownTime_wait"); %>*1;
		var seconds_word=" seconds ";
		var is_ulinker="<% getInfo("is_ulinker"); %>"*1;
		
		if(is_ulinker == 1)
		{
			if(count<40)
			{
				if(parent.isOtg_Auto == 1)
					count = count+20;
				else {
					//if (pocketRouter_Mode == 1)
					count = count+20;
				}
			}
		}
		else
		{
		if(waitcount==1 && (pocketRouter_Mode==1 || pocketRouter_Mode==2) ){
			count=90;
		}else if(waitcount==2 && (pocketRouter_Mode==1 || pocketRouter_Mode==2) ){
			count=120;
		}
		}
			
		function get_by_id(id)
		{
			with(document)
			{
				return getElementById(id);
			}
		}
		
		function change_state(istate)
		{
			if(parent.frames[1])
			{
			parent.frames[1].state = istate;			
			MTMDisplayMenu();
		}
		
			if(pocketRouter_Mode == 1){
				if (is_ulinker == 0)
				get_by_id("show_msg").innerHTML = "Please wait awhile and re-open browser to configure Pocket Router. ";
				else
					get_by_id("show_msg").innerHTML = "Please wait awhile and re-open browser to configure Universal Linker. ";
				
			}
		}
		
		function closeBrowser()
		{
			parent.window.close();			
		}
		
		
		function do_count_down()
		{
			
		
			get_by_id("show_sec").innerHTML = count;
			
			if(count == 0) 
			{
				var browser=eval ( '"' + top.location + '"' );
				var domainName = "<% getInfo("domainName"); %>";
				var connect_url;
				var redirect_ip = "<% getInfo("redirect_ip"); %>";
                var old_url=window.location.href;
                var https;
				change_state('normal');
                if(old_url.indexOf("https:")>=0)
                {
                    https=1;
                }
                else
                {
                    https=0;
                }

				
				if(pocketRouter_Mode != 0)
				{
					if (is_ulinker == 0) 
					{
					if((pocketRouter_Mode == 2) || (pocketRouter_Mode == 3))
						domainName = domainName+"ap";
					else
						domainName = domainName+"cl";
					}
						
//alert("browser="+browser);
					domainName = domainName.toLowerCase();
//alert("domainName="+domainName);

				if (is_ulinker == 0) {
					if (browser.indexOf(redirect_ip) > -1 )
					{
						connect_url=redirect_ip;
						
					}
					else if (browser.indexOf("www."+domainName+".net") > -1 )
					{
						connect_url = "www."+domainName+".com";
					}
					else if(browser.indexOf("www."+domainName+".com") > -1 )
					{
						connect_url = "www."+domainName+".net";
					}
					else if (browser.indexOf(domainName+".net") > -1 )
					{
						connect_url = domainName+".com";
					}
					else if(browser.indexOf(domainName+".com") > -1 )
					{
						connect_url = domainName+".net";
					}
					else if (browser.indexOf(domainName) > -1 )
					{
						connect_url = domainName+".com";
					}
					else
					{
						connect_url = domainName+".com";
					}
				}
				else {
					if (browser.indexOf(redirect_ip) > -1 )
					{
						connect_url=redirect_ip;
						
					}
					else if (browser.indexOf("www."+domainName+".com.tw") > -1 )
					{
						connect_url = "www."+domainName+".com";
					}
					else if(browser.indexOf("www."+domainName+".com") > -1 )
					{
						connect_url = "www."+domainName+".com.tw";
					}
					else if (browser.indexOf(domainName+".com.tw") > -1 )
					{
						connect_url = domainName+".com";
					}
					else if(browser.indexOf(domainName+".com") > -1 )
					{
						connect_url = domainName+".com.tw";
					}
					else if (browser.indexOf(domainName) > -1 )
					{
						connect_url = domainName+".com";
					}
					else
					{
						connect_url = domainName+".com";
					}
				}
					
				}
				else
				{
					connect_url=redirect_ip;
				}
				
				var lastUrl="<% getInfo("lastUrl"); %>";
				
				if(lastUrl == "/wizard.htm")
				{
                    if(https==1)
                        parent.location.href = 'https://'+connect_url;
                    else
                        parent.location.href = 'http://'+connect_url;
                }
				else
				{
				    if(https==1)	
                    {
                        var location_href = 'https://'+connect_url+lastUrl+'?t='+new Date().getTime();				
                            parent.location.href = 'https://'+connect_url;
                    }else
                    {
					var location_href = 'http://'+connect_url+lastUrl+'?t='+new Date().getTime();								
					parent.location.href = 'http://'+connect_url;
                    }
				}
				
				return false;
			}
			
			if (count > 0) 
			{
				
				count--;
				setTimeout('do_count_down()',1000);
			}
		}
	</script>
</head>
<body onload="change_state('normal');do_count_down();">
	<div id="countDownPage" style="display: none;">
		<h4 class="i18n" name="change_settings_s"></h4><br>
		<span id="show_msg" class="i18n" name="change_settings_donot"></span>
		<P align="left">
			<span id="please_wait" class="i18n" name="change_settings_pw"></span><span id="show_sec"></SPAN>&nbsp;<span id="show_seconds" class="i18n" name="change_settings_second"></SPAN>
		</P>
		<span id = "close_button" class = "off" >
			<input type="button" value="  OK  " name="cancel" onClick='closeBrowser();'>
		</span>
	</div>
	<div class="popup"></div>
	<div class="popbox window" id="center">
		<div class="progress">
			<div class="wrapper">
				<div class="load-bar">
					<span id="counter">0%</span>
					<div class="load-bar-inner" data-loading="0"></div>
				</div>
				<p class="i18n" name="reset_name_internet"></p>
			</div>
		</div>
		</div>
	<script src="js/jquery.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<!-- 加载语言包文件 -->
	<script src="js/jquery.i18n.properties.js"></script>
	<script src="js/language.js"></script>
	<script>
	//进度条-start
	//获取窗口的高度 
	 var windowHeight; 
	 //获取窗口的宽度 
	 var windowWidth; 
	 //获取弹窗的宽度 
	 var popWidth; 
	 //获取弹窗高度 
	 var popHeight; 
	 function init(){ 
	    windowHeight=$(window).height(); 
	    windowWidth=$(window).width(); 
	    popHeight=$(".window").height(); 
	    popWidth=$(".window").width(); 
	 } 
	 popCenterWindow();
	 $(".popup").show();
	 //定义弹出居中窗口的方法 
     function popCenterWindow(){ 
         init(); 
         //计算弹出窗口的左上角Y的偏移量 
		 var popY=(windowHeight-popHeight)/2; 
	     var popX=(windowWidth-popWidth)/2; 
	      //设定窗口的位置 
	     $("#center").css("top",popY).css("left",popX).slideToggle("slow");  
      }
		
		//获取dom对象
		var count = <% getInfo("countDownTime"); %>*1;
		var content = document.getElementsByClassName('load-bar-inner');
		var content2 = document.getElementById("counter");
		content = content[0];
		var go; //设置定时的名字
		var flag = true; //用于判断是否点击了按钮
		if(flag) {
		//如果点击了就改为false
			flag = false;
			go = setInterval(function() {
			    if(content.offsetWidth < 400) {
			    	content.style.width = content.offsetWidth + 4 + 'px';
					content2.innerHTML = parseInt(content.offsetWidth /4) + '%';
			    	content2.style.color = '#FFFFFF';
			    } else {
			    	content.style.backgroundColor = '#0096F5';
			    	clearInterval(go);
			    }

			}, count*10)
		}//进度条——end	
		
             
         
	</script>
</body>
</html>
