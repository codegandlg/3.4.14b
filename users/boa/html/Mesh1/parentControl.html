<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<meta id="i18n_pagename" content="index-common">
	    <meta name="keywords" content=""/>
	    <meta name="description" content=""/>
	    <meta http-equiv="Access-Control-Allow-Origin" content="*">
	    <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
		<link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/libs/font-awesome.css"/>	
		<link href="css/bootstrap-switch.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/bootstrap-table.css" />
		<link rel="stylesheet" type="text/css" href="css/base.css"/>
		<link rel="stylesheet" href="css/main.css" />
		<link rel="stylesheet" href="css/bootstrap/bootstrap-datetimepicker.min.css" />
		<link type="image/x-icon" href="img/favicon.png" rel="shortcut icon"/>
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.js"></script>
		<script src="js/bootstrap-table.js"></script>
		<script src="js/bootstrap-switch.min.js"></script>
		<style type="text/css">
			.timeSelect .timeSelect2{
				width: auto;
			}
			.guest_net_parent{
				width: 95%;
			}
			.modal-dialog{
				width: 60%;
			}
		</style>
	</head>
	<body onload="settings()">
		<div class="guest_net_parent">
			<form action="/boafrm/formParentContrl" method="POST"  name="formParentContrlAdd2">
			<div class="form-group" style="margin-bottom: 10px;">
				<div class="intell guest_mode i18n" name="Control_parennt"></div>
				
				<div class="switch_check">
					<input type="checkbox" class="checkbox_switch" data-size="mini" name="status" />
				</div>
				<input type="hidden" name="enabled" id="parentControl_enable"/>
				<!--<button type="submit" class="systemmanage_button2 i18n" name="save_apply" value="1"></button>-->
			</div>
			
			<input type="hidden" value="/parentControl.html" name="submit-url">
			</form>
			
			
			<button id="mymodelSelect" class="btn btn-primary" data-toggle="modal" data-target="#myModal" style="margin: 15px 0;display: none;outline: none;"><i class="fa fa-plus-square fa-lg"></i><span class="i18n" name="add_item" style="margin-left: 5px;"></span></button>
			<!-- 模态框（Modal） -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<form action="/boafrm/formParentContrl" method="POST" name="formParentContrlAdd">
			    <div class="modal-dialog">
			        <div class="modal-content">
			            <div class="modal-header">
			                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			                <h4 class="modal-title i18n" id="myModalLabel" name="terminal_select_parent"></h4>
			            </div>
			            <div class="modal-body">
			            	<div class="weekSelect">
			            		<span class="tips_parent i18n" name="week_select_parent"></span>
			            		<ul>			
			            			<li><a href="#"><input type="checkbox" name="Mon" value="1" ONCLICK=week()><span class="i18n" name="mon_parent"></span></a></li>
			            			<li><a href="#"><input type="checkbox" name="Tues" value="1" ONCLICK=week()><span class="i18n" name="Tues_parent"></span></a></li>
			            			<li><a href="#"><input type="checkbox" name="Wed" value="1" ONCLICK=week()><span class="i18n" name="Wed_parent"></span></a></li>
			            			<li><a href="#"><input type="checkbox" name="Thur" value="1" ONCLICK=week()><span class="i18n" name="Thur_parent"></span></a></li>
			            			<li><a href="#"><input type="checkbox" name="Fri" value="1" ONCLICK=week()><span class="i18n" name="Fri_parent"></span></a></li>
			            			<li><a href="#"><input type="checkbox" name="Sat" value="1" ONCLICK=week()><span class="i18n" name="Sat_parent"></span></a></li>
			            			<li><a href="#"><input type="checkbox" name="Sun" value="1" ONCLICK=week()><span class="i18n" name="Sun_parent"></span></a></li>			            			
			            		</ul>
			            	</div>
			            	<div class="timeSelect">
			            		<span class="tips_parent i18n" name="time_select_parent"></span>
			            		<ul>
			            			<li><a href="#">
			            				<div class="startTime"><label class="i18n" name="start_t_parent"></label>
			            					<select name="" class="timeSelect2" id="hours">
				            			
						            		</select>
						            		<select name="" class="timeSelect2" id="minutes">
						            			
						            		</select>
						            		
			            				</div>
			            				
			            				<div class="endTime"><label class="i18n" name="end_t_parent"></label>
			            					<select name="" class="timeSelect2" id="hours2">
				            			
						            		</select>
						            		<select name="" class="timeSelect2" id="minutes2">
						            			
						            		</select>
			            				</div>
			            			</a></li>			            			
			            		</ul>
			            		<input type="hidden" name="parent_start_time" id="parent_start_time"/>
			            		<input type="hidden" name="parent_end_time" id="parent_end_time"/>
			            	</div>
			            	<div class="terminalSelect">
			            		<table border="0" width="500">
								  <tr><label style="font-size: 16px;border-left: 3px solid #89CEED;padding-left: 15px;" class="i18n" name="terminal_list_parent"></label></tr>
								  <% parentContrlTerminalList(); %>
								 </table>
			            	</div>
			            </div>
			            <div class="modal-footer">
			                <button type="button" class="btn btn-default i18n" data-dismiss="modal" name="close_parent"></button>
			                <button type="submit" class="btn btn-primary i18n" value="Save" name="addParentContrl" class="i18n" onclick="return submitClick()"></button>
			            </div>
			        </div><!-- /.modal-content -->
			    </div><!-- /.modal -->
			    <input type="hidden" value="/parentControl.html" name="submit-url">
			    </form>
			    
			</div>
			<form action="/boafrm/formParentContrl" method="POST" name="formParentContrlDel">
			<div class="panel panel-default" style="display: none;"> 
				<div class="panel-body table-responsive"> 
					<h4 class="i18n" name="ControlTerminal"></h4>　　　　　　　　 
			    	<table class="table table-striped table-bordered table-hover" id="tableL01"> </table> 
			    </div> 
			</div>
			<div id="deleteControl" style="display: none;">
						
			</div>
			<input type="hidden" value="Delete Selected" name="deleteSelParentContrl" onClick="return deleteClick()"  class="i18n">
			<input type="hidden" value="/parentControl.html" name="submit-url">
			</form>
			<!--<div style="display: none;">
				<form action="/boafrm/formParentContrl" method="POST" name="formParentContrlDel">
					<div id="deleteControl">
						
					</div>
					<input type="submit" value="Delete Selected" name="deleteSelParentContrl" onClick="return deleteClick()"  class="i18n">
				</form>
			</div>-->
			
		</div>
		
		
		<script src="js/bootstrap-datetimepicker.js"></script>
		<script src="js/jquery.cookie.js"></script>
	    <!-- 加载语言包文件 -->
	    <script src="js/jquery.i18n.properties.js"></script>
	    <script src="js/language.js"></script>
	    
		<script>
			var i18nLanguage=getCookie('userLanguage');
			var status='<% getIndex("parentContrlEnabled"); %>' ;
			$(document).ready(function(){
				
				//开关按钮
				$('[name="status"]').bootstrapSwitch({
					onText: "",
					offText: "",
					onColor: "success",
					offColor: "info",
					size: "small",
					onSwitchChange: function(event, state) {
						if (state == true) {
							$(".panel-default,#mymodelSelect").css("display","block");
							$("#parentControl_enable").val("ON");
							if(status=='0'){
								document.formParentContrlAdd2.submit();
							}
							
						} else {
							$(".panel-default,#mymodelSelect").css("display","none");
							$("#parentControl_enable").val("OFF");
							if(status=='1'){
								document.formParentContrlAdd2.submit();
							}
						}
					}
				});
//				if (window.performance) {
//				  console.info("window.performance works fine on this browser");
//				}
//				  if (performance.navigation.type == 1) {
//				    console.info( "This page is reloaded" );
//				    location.hash='/app/homepage'
//				  } else {
//				    console.info( "This page is not reloaded");
//				  }
//				$('input[name="enabled"]').change(function(){
//					alert(11111111111111111111);
//				})
//				$('input[name="enabled"]').bootstrapSwitch({ onSwitchChange:function(){
//				console.log(111)
//				} });

				set_option();
				
//				$('[name="enabled"]').on('switch-change', function (e, data) {
//				    var $el = $(data.el)
//				      , value = data.value;
//				    console.log(e, $el, value);
//				});

				var data_List=[];
//				var tab_data={"select1":[{"parentContrlMon":"0","parentContrlWeekTues":"1","parentContrlWeekThur":"1","parentContrlWeekWed":"1","parentContrlWeekFri":"0","parentContrlWeekSat":"0","parentContrlWeekSun":"0","parentContrlStartTime":"590","parentContrlEndTime":"70","parentContrlTerminal":"D0:51:57:B2:2E:35;00:E0:4C:B5:54:F0;00:D8:61:27:"}],"select2":[{"parentContrlMon":"0","parentContrlWeekTues":"1","parentContrlWeekThur":"1","parentContrlWeekWed":"1","parentContrlWeekFri":"1","parentContrlWeekSat":"1","parentContrlWeekSun":"0","parentContrlStartTime":"20","parentContrlEndTime":"1430","parentContrlTerminal":"44:1A:FA:12:5A:CD;6C:4B:90:9D:E8:9D;D0:51:57:B2:"}],"select3":[{"parentContrlMon":"0","parentContrlWeekTues":"1","parentContrlWeekThur":"1","parentContrlWeekWed":"1","parentContrlWeekFri":"1","parentContrlWeekSat":"0","parentContrlWeekSun":"0","parentContrlStartTime":"20","parentContrlEndTime":"1435","parentContrlTerminal":"D0:51:57:B2:2E:2E;6C:4B:90:9D:E8:A7;D0:51:57:B2:"}]};
				var tab_data=<% parentContrlList(); %>;
				for(var i in tab_data){					
					data_List.push(tab_data[i][0]);
				}
				
				var title1,title2,title3,title4,title5,title6,title7,title8,title9,title10,title11;
				if(i18nLanguage=='en'){
					title1="Monday";title2="Tuesday";title3="Wednesday";title4="Thursday";title5="Friday";title6="Saturday";title7="SundaySunday";title8="StartTime";title9="EndTime";title10="Managemen Terminal";title11="Operation";
				}else{
					title1="星期一";title2="星期二";title3="星期三";title4="星期四";title5="星期五";title6="星期六";title7="星期日";title8="起始时间";title9="结束时间";title10="管理终端";title11="操作";				
				}
				//表格
				var tableColumns = [
                {field: 'parentContrlMon', title: title1, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlWeekTues', title: title2, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlWeekWed', title: title3, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlWeekThur', title: title4, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlWeekFri', title: title5, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlWeekSat', title: title6, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlWeekSun', title: title7, sortable: false,formatter:function(cellvalue, options, rowdata){
                	if(i18nLanguage=='en'){
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">No</span>';
	                	}else{
	                		return "Yes";
	                	}
			    	}else{
			    		if(cellvalue==0){
	                		return '<span style="color:#ccc">否</span>';
	                	}else{
	                		return "是";
	                	}
			    	}
                }},
                {field: 'parentContrlStartTime', title: title8, sortable: false,formatter:function(cellvalue, options, rowdata){
                	var hours_value=Math.floor(cellvalue/60);
                	var minutes_value=cellvalue%60;
                	if(hours_value<10){
                		hours_value="0"+hours_value;
                	}
                	if(minutes_value<10){
                		minutes_value="0"+minutes_value;
                	}
                	return hours_value+":"+minutes_value;
                }},
                {field: 'parentContrlEndTime', title: title9, sortable: false,formatter:function(cellvalue, options, rowdata){
                	var hours_value=Math.floor(cellvalue/60);
                	var minutes_value=cellvalue%60;
                	if(hours_value<10){
                		hours_value="0"+hours_value;
                	}
                	if(minutes_value<10){
                		minutes_value="0"+minutes_value;
                	}
                	return hours_value+":"+minutes_value;
                }},
                {field: 'parentContrlTerminal', title: title10, sortable: false},
                {field:"usid",title:title11,sortable:false,formatter:function(cellvalue, options, rowdata){
		        	  var html='<div>';
		        	  html+='<button type="submit" class="table-link" style="border:none;background:none;" onclick="accountConfig(\''+rowdata+'\')" ><i class="fa fa-trash-o"></i> </button></div>';
	        		  return html;
		          }}
            ];
            $('#tableL01').bootstrapTable('destroy');   //动态加载表格之前，先销毁表格

            $('#tableL01').bootstrapTable({//表格初始化
                columns: tableColumns,  //表头
                data:data_List, //通过ajax返回的数据
                width:350,
                method: 'get',
                pageSize: 200,
                pageNumber: 1,
                pageList: [],
                cache: false,
                search: false,
            });
           function set_option(){
				var html1="",html2="";
				for(var i=0;i<24;i++){
					html1+='<option value="'+i+'">'+i+'</option>';
				}
				$("#hours").append(html1);
				$("#hours2").append(html1);
				for(var i=0;i<60;i++){
					if(i<10){
						html2+='<option value="0'+i+'">0'+i+'</option>';
					}else{
						html2+='<option value="'+i+'">'+i+'</option>';
					}
					
				}
				$("#minutes").append(html2);
				$("#minutes2").append(html2);
			}	    
		})		
		function settings(){
			var status='<% getIndex("parentContrlEnabled"); %>' ;
			if(status=='0'){
				$('[name="status"]').bootstrapSwitch('state', false);
				$(".panel-default,#mymodelSelect").css("display","none");
			}else{
				$('[name="status"]').bootstrapSwitch('state', true);
				$(".panel-default,#mymodelSelect").css("display","block");
			}
		}
		function submitClick(){
			var parent_start_time_value=$("#hours option:selected").val();
			var parent_end_time_value=$("#hours2 option:selected").val();
			if(parent_start_time_value==""||parent_end_time_value==""){
				if(i18nLanguage=='en'){
					alert("Please select start time or end time");
				}else{
					alert("请选择开始时间或结束时间");
				}
				return false;
			}else{
				var start_time_hours=$("#hours option:selected").val();
				var start_time_minutes=$("#minutes option:selected").val();
				var end_time_hours=$("#hours2 option:selected").val();
				var end_time_minutes=$("#minutes2 option:selected").val();
				var start_1=parseInt(start_time_hours)*60+parseInt(start_time_minutes);
				var end_1=parseInt(end_time_hours)*60+parseInt(end_time_minutes);
				if(start_1>=end_1){
					if(i18nLanguage=='en'){
						alert("The end time cannot be less than or equal to the start time");
					}else{
						alert("结束时间不能小于或等于开始时间！");
					}
					return false;
				}else{
					$("#parent_start_time").val(start_1);
					$("#parent_end_time").val(end_1);
				}
			}
			var check_value=$(".terminalSelect").find("input[type='checkbox']").prop("checked");
			if(!check_value){
				if(i18nLanguage=='en'){
					alert("Please select control terminal");
				}else{
					alert("请选择控制终端！");
				}
				return false;
			}
			return true;
		}
		function deleteClick()
		{
		  if(i18nLanguage=='en'){
		  	if ( !confirm("Confirm Delete？") ) {
				return false;
			  }else{return true;}
		  }else{
		  	if ( !confirm("确认删除？") ) {
				return false;
			  }else{return true;}
		  }
		  
			
		}
		function accountConfig(value){
			$("#deleteControl").html("");
			var selected_num=parseInt(value);
			var html='<input type="hidden" name="select'+(selected_num+1)+'" value="ON"/>';
			$("#deleteControl").append(html);
			document.formParentContrlDel.submit();
			location.reload();
		}
		
		function getCookie(name) {
		  var cookies = document.cookie;
		  var list = cookies.split("; ");          // 解析出名/值对列表
		      
		  for(var i = 0; i < list.length; i++) {
		    var arr = list[i].split("=");          // 解析出名和值
		    if(arr[0] == name)
		      return decodeURIComponent(arr[1]);   // 对cookie值解码
		  } 
		  return "";
		}
		</script>
	</body>
</html>
